---
  - name: "Install Pritunl Zero (docker)"
    hosts: localhost
    connection: local
    vars:
      app_name: "pritunl"
    become: yes
    tasks:
    - name: Deploy compose files
      copy: src=etc/ dest=/etc/docker/compose/{{ app_name }}/

    - name: Create env file for the compose file
      copy:
        dest: "/etc/docker/compose/{{ app_name }}/.env"
        content: "PRITUNL_DOMAIN={{ lookup('env', 'PRITUNL_DOMAIN') }}"

    - name: mkdir secrets
      file: state=directory path=/etc/docker/compose/{{ app_name }}/secrets/

    - name: Create secret mongodb_root_pw
      copy:
        dest: "/etc/docker/compose/{{ app_name }}/secrets/mongodb_root_pw.txt"
        content: "{{ lookup('env', 'PRITUNL_MONGODB_ROOT_PASSWORD') }}"

    - name: mkdir volumes
      file: state=directory path=/opt/compose/volumes/{{ app_name }}/
